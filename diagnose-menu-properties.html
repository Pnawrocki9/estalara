<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnostyka: Menu i LIVE Properties</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .log-line {
            font-family: 'Courier New', monospace;
            padding: 0.5rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .log-info { background-color: #eff6ff; }
        .log-success { background-color: #f0fdf4; color: #166534; }
        .log-warn { background-color: #fffbeb; color: #92400e; }
        .log-error { background-color: #fef2f2; color: #991b1b; }
    </style>
</head>
<body class="bg-gray-50 p-6">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-gray-900">üîç Diagnostyka: Menu i LIVE Properties</h1>
        
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Wyniki diagnostyki</h2>
            <div id="results" class="space-y-2"></div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">Dane w localStorage</h2>
            <pre id="data-display" class="bg-gray-100 p-4 rounded overflow-auto max-h-96 text-xs"></pre>
        </div>
    </div>

    <script>
        const results = document.getElementById('results');
        const dataDisplay = document.getElementById('data-display');

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log-line log-${type}`;
            div.textContent = message;
            results.appendChild(div);
        }

        function diagnose() {
            log('üöÄ Rozpoczƒôcie diagnostyki...', 'info');
            
            // 1. Sprawd≈∫ localStorage
            log('\n=== KROK 1: Sprawdzanie localStorage ===', 'info');
            let data = null;
            try {
                const stored = localStorage.getItem('estalaraAdminData');
                if (!stored) {
                    log('‚ùå Brak danych w localStorage (klucz: estalaraAdminData)', 'error');
                } else {
                    log('‚úÖ Dane znalezione w localStorage', 'success');
                    data = JSON.parse(stored);
                    dataDisplay.textContent = JSON.stringify(data, null, 2);
                }
            } catch (e) {
                log('‚ùå B≈ÇƒÖd podczas odczytu localStorage: ' + e.message, 'error');
            }

            // 2. Sprawd≈∫ navigation
            log('\n=== KROK 2: Sprawdzanie navigation ===', 'info');
            if (!data) {
                log('‚ö†Ô∏è Brak danych do analizy', 'warn');
            } else if (!data.navigation) {
                log('‚ùå Brak klucza "navigation" w danych', 'error');
            } else if (!Array.isArray(data.navigation)) {
                log('‚ùå "navigation" nie jest tablicƒÖ: ' + typeof data.navigation, 'error');
            } else if (data.navigation.length === 0) {
                log('‚ùå Tablica "navigation" jest pusta', 'error');
            } else {
                log('‚úÖ navigation znaleziono: ' + data.navigation.length + ' element√≥w', 'success');
                data.navigation.forEach((item, i) => {
                    log(`   ${i+1}. ${item.label} ‚Üí ${item.url}`, 'info');
                });
            }

            // 3. Sprawd≈∫ liveProperties
            log('\n=== KROK 3: Sprawdzanie liveProperties ===', 'info');
            if (!data) {
                log('‚ö†Ô∏è Brak danych do analizy', 'warn');
            } else if (!data.liveProperties && !data.properties) {
                log('‚ùå Brak kluczy "liveProperties" ani "properties" w danych', 'error');
            } else {
                // Sprawd≈∫ liveProperties
                if (data.liveProperties) {
                    if (!Array.isArray(data.liveProperties)) {
                        log('‚ùå "liveProperties" nie jest tablicƒÖ: ' + typeof data.liveProperties, 'error');
                    } else if (data.liveProperties.length === 0) {
                        log('‚ö†Ô∏è Tablica "liveProperties" jest pusta', 'warn');
                    } else {
                        log('‚úÖ liveProperties znaleziono: ' + data.liveProperties.length + ' nieruchomo≈õci', 'success');
                        data.liveProperties.forEach((prop, i) => {
                            log(`   ${i+1}. ${prop.title} - ${prop.location}`, 'info');
                        });
                    }
                } else {
                    log('‚ö†Ô∏è Brak klucza "liveProperties" - sprawdzam stare "properties"', 'warn');
                }

                // Sprawd≈∫ properties (backward compatibility)
                if (data.properties) {
                    if (!Array.isArray(data.properties)) {
                        log('‚ùå "properties" nie jest tablicƒÖ: ' + typeof data.properties, 'error');
                    } else if (data.properties.length === 0) {
                        log('‚ö†Ô∏è Tablica "properties" jest pusta', 'warn');
                    } else {
                        const liveProps = data.properties.filter(p => !p.status || p.status === 'live');
                        log('‚úÖ properties znaleziono: ' + liveProps.length + ' nieruchomo≈õci ze statusem "live"', 'success');
                        liveProps.forEach((prop, i) => {
                            log(`   ${i+1}. ${prop.title} - ${prop.location}`, 'info');
                        });
                    }
                }
            }

            // 4. Sprawd≈∫ Firebase adapter
            log('\n=== KROK 4: Sprawdzanie Firebase ===', 'info');
            if (typeof window.cmsFirebaseAdapter === 'undefined') {
                log('‚ö†Ô∏è Firebase adapter nie jest za≈Çadowany', 'warn');
            } else if (!window.cmsFirebaseAdapter.cache) {
                log('‚ö†Ô∏è Firebase cache jest pusty', 'warn');
            } else {
                log('‚úÖ Firebase adapter za≈Çadowany z cache', 'success');
                const fbData = window.cmsFirebaseAdapter.cache;
                log('   - navigation: ' + (fbData.navigation?.length || 0) + ' element√≥w', 'info');
                log('   - liveProperties: ' + (fbData.liveProperties?.length || 0) + ' element√≥w', 'info');
            }

            // 5. Sprawd≈∫ DOM
            log('\n=== KROK 5: Sprawdzanie DOM ===', 'info');
            const desktopNav = window.opener?.document.querySelector('header nav:not(#mobile-menu) ul');
            const mobileNav = window.opener?.document.querySelector('#mobile-menu ul.mobile-nav');
            const propertiesGrid = window.opener?.document.querySelector('#live-properties .grid');
            
            if (!window.opener) {
                log('‚ö†Ô∏è Nie mo≈ºna sprawdziƒá DOM - otw√≥rz tƒô stronƒô z index.html', 'warn');
            } else {
                if (!desktopNav) {
                    log('‚ùå Nie znaleziono desktop navigation (header nav ul)', 'error');
                } else {
                    log('‚úÖ Desktop navigation znaleziono: ' + desktopNav.children.length + ' element√≥w', 'success');
                }
                
                if (!mobileNav) {
                    log('‚ùå Nie znaleziono mobile navigation (#mobile-menu ul.mobile-nav)', 'error');
                } else {
                    log('‚úÖ Mobile navigation znaleziono: ' + mobileNav.children.length + ' element√≥w', 'success');
                }
                
                if (!propertiesGrid) {
                    log('‚ùå Nie znaleziono kontenera properties (#live-properties .grid)', 'error');
                } else {
                    log('‚úÖ Properties grid znaleziono: ' + propertiesGrid.children.length + ' element√≥w', 'success');
                }
            }

            // 6. Wersja danych
            log('\n=== KROK 6: Wersja danych ===', 'info');
            if (data && data.version) {
                log('‚úÖ Wersja danych: ' + data.version, 'success');
            } else {
                log('‚ö†Ô∏è Brak informacji o wersji danych', 'warn');
            }

            // PODSUMOWANIE
            log('\n=== PODSUMOWANIE ===', 'info');
            const hasNavigation = data && data.navigation && Array.isArray(data.navigation) && data.navigation.length > 0;
            const hasProperties = data && ((data.liveProperties && data.liveProperties.length > 0) || (data.properties && data.properties.filter(p => !p.status || p.status === 'live').length > 0));
            
            if (hasNavigation && hasProperties) {
                log('‚úÖ Wszystko wyglƒÖda dobrze! Menu i LIVE Properties powinny byƒá widoczne.', 'success');
                log('   Je≈õli nie sƒÖ widoczne, sprawd≈∫ konsolƒô przeglƒÖdarki w index.html', 'info');
            } else {
                if (!hasNavigation) {
                    log('‚ùå PROBLEM: Brak danych navigation', 'error');
                    log('   ROZWIƒÑZANIE: Przejd≈∫ do CMS i zapisz nawigacjƒô', 'warn');
                }
                if (!hasProperties) {
                    log('‚ùå PROBLEM: Brak danych LIVE Properties', 'error');
                    log('   ROZWIƒÑZANIE: Przejd≈∫ do CMS ‚Üí LIVE Properties i dodaj nieruchomo≈õci', 'warn');
                }
            }
        }

        // Uruchom diagnostykƒô
        diagnose();
    </script>
</body>
</html>
