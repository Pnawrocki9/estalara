<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Populate FAQ to CMS</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-weight: 500;
        }
        .status.info {
            background: #e3f2fd;
            color: #1976d2;
        }
        .status.success {
            background: #e8f5e9;
            color: #2e7d32;
        }
        .status.error {
            background: #ffebee;
            color: #c62828;
        }
        button {
            background: #000;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }
        button:hover {
            background: #333;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .log {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .log div {
            margin: 5px 0;
        }
        .login-section {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .login-input {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .user-info {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logout-btn {
            background: #dc3545;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .logout-btn:hover {
            background: #c82333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìù Populate FAQ to CMS</h1>
        <p>This tool will populate all FAQ questions from the frontend into the Firebase CMS database.</p>
        
        <!-- Authentication Section -->
        <div id="loginSection" class="login-section" style="display: none;">
            <h3 style="margin-top: 0;">üîê Authentication Required</h3>
            <p>You must sign in with your @estalara.com account to populate FAQ content.</p>
            <form id="loginForm" onsubmit="handleLogin(event)">
                <input type="email" id="email" class="login-input" placeholder="admin@estalara.com" required>
                <input type="password" id="password" class="login-input" placeholder="Password" required>
                <button type="submit" style="margin-top: 10px;">Sign In</button>
            </form>
        </div>
        
        <!-- User Info Section (shown when authenticated) -->
        <div id="userInfo" class="user-info" style="display: none;">
            <div>
                <strong>‚úÖ Signed in as:</strong> <span id="userEmail"></span>
            </div>
            <button class="logout-btn" onclick="handleLogout()">Sign Out</button>
        </div>
        
        <div class="status info" id="status">
            Initializing authentication...
        </div>
        
        <button onclick="populateFAQ()" id="populateBtn" disabled>Populate FAQ to CMS</button>
        
        <div class="log" id="log" style="display: none;">
            <strong>Activity Log:</strong>
            <div id="logContent"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="firebase-init.js"></script>
    <script src="firebase-auth.js"></script>

    <script>
        let currentUser = null;

        function log(message) {
            const logDiv = document.getElementById('log');
            const logContent = document.getElementById('logContent');
            logDiv.style.display = 'block';
            const entry = document.createElement('div');
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContent.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function setStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }

        // Handle login
        async function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            setStatus('Signing in...', 'info');
            
            try {
                const result = await window.firebaseSignIn(email, password);
                
                if (result.success) {
                    log('‚úÖ Signed in successfully as ' + result.user.email);
                    currentUser = result.user;
                    updateUIForAuth(result.user);
                } else {
                    setStatus('‚ùå Login failed: ' + result.error, 'error');
                    log('‚ùå Login failed: ' + result.error);
                }
            } catch (error) {
                setStatus('‚ùå Login error: ' + error.message, 'error');
                log('‚ùå Login error: ' + error.message);
            }
        }

        // Handle logout
        async function handleLogout() {
            try {
                await window.firebaseSignOut();
                currentUser = null;
                updateUIForNoAuth();
                log('‚úÖ Signed out successfully');
            } catch (error) {
                setStatus('‚ùå Logout error: ' + error.message, 'error');
            }
        }

        // Update UI when authenticated
        function updateUIForAuth(user) {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('userInfo').style.display = 'flex';
            document.getElementById('userEmail').textContent = user.email;
            document.getElementById('populateBtn').disabled = false;
            setStatus('‚úÖ Authenticated. Ready to populate FAQ content.', 'success');
        }

        // Update UI when not authenticated
        function updateUIForNoAuth() {
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('userInfo').style.display = 'none';
            document.getElementById('populateBtn').disabled = true;
            setStatus('‚ö†Ô∏è Please sign in to continue', 'info');
        }

        // Initialize authentication check
        async function initAuth() {
            try {
                // Wait for Firebase to be ready
                await window.firebaseReadyPromise;
                log('‚úÖ Firebase initialized');
                
                // Wait for auth service to be ready
                let waitTime = 0;
                const maxWait = 5000;
                while (!window.authService && waitTime < maxWait) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    waitTime += 100;
                }
                
                if (!window.authService) {
                    setStatus('‚ùå Auth service failed to initialize', 'error');
                    return;
                }
                
                log('‚úÖ Auth service initialized');
                
                // Check if already authenticated
                const user = await window.authService.waitForAuth();
                if (user) {
                    currentUser = user;
                    updateUIForAuth(user);
                    log('‚úÖ Already authenticated as ' + user.email);
                } else {
                    updateUIForNoAuth();
                    log('‚ö†Ô∏è Not authenticated. Please sign in.');
                }
            } catch (error) {
                setStatus('‚ùå Initialization error: ' + error.message, 'error');
                log('‚ùå Initialization error: ' + error.message);
            }
        }

        // Run auth initialization on page load
        window.addEventListener('DOMContentLoaded', initAuth);

        const faqData = {
            general: [
                {
                    question: "How does Estalara work?",
                    answer: "Estalara connects real estate agents and global investors through livestreaming technology. Agents can broadcast property tours in real-time, while investors from around the world can participate, ask questions, and express interest immediately. Our AI-powered platform handles lead matching, translation, and transaction support."
                },
                {
                    question: "Is Estalara available in my country?",
                    answer: "Estalara operates in over 50 countries worldwide and supports 25+ languages, making international real estate accessible to investors and agents globally. We provide services across Europe, North America, Latin America, Asia, and the Middle East."
                },
                {
                    question: "What languages does Estalara support?",
                    answer: "Estalara supports over 25 languages including English, Spanish, French, German, Chinese, Arabic, Portuguese, Italian, Russian, and many more. Our AI-powered translation ensures real-time communication between agents and investors regardless of their native language."
                },
                {
                    question: "What is EstalaraAI?",
                    answer: "EstalaraAI is our natural language property assistant that provides accurate, hallucination-free responses to questions about properties, markets, legal requirements, and investment opportunities. It supports multiple languages and helps both agents and investors make informed decisions."
                }
            ],
            agents: [
                {
                    question: "How do I get started as an agent on Estalara?",
                    answer: "Sign up at app.estalara.com, verify your credentials and professional license, complete your agent profile, and start listing properties. Our onboarding process typically takes 24-48 hours for verification. Once approved, you can immediately start livestreaming properties to our global investor network."
                },
                {
                    question: "What are the costs for real estate agents?",
                    answer: "Estalara offers flexible pricing plans for agents based on their needs. We have options for individual agents, small teams, and large agencies. Plans include per-listing fees, subscription models, and commission-based options. Contact us at agents@estalara.com for detailed pricing information tailored to your requirements."
                },
                {
                    question: "How does the AI lead generation work?",
                    answer: "Our AI analyzes investor behavior, preferences, search patterns, and engagement during live tours to match them with relevant properties. Agents receive qualified leads with detailed insights about investor interests, budget, and purchase timeline, enabling more effective follow-up. The system learns from each interaction to improve matching accuracy."
                },
                {
                    question: "Do I need special equipment for livestreaming?",
                    answer: "No special equipment needed! You can livestream directly from your smartphone. Our mobile app includes professional features like image stabilization, filters, and quality optimization. For best results, we recommend good lighting and a stable internet connection."
                },
                {
                    question: "How do I handle international transactions?",
                    answer: "Estalara provides comprehensive support for cross-border transactions including connections to trusted notaries, title insurance providers, currency exchange services, and legal experts in each market. Our platform guides you through each step of the international transaction process."
                }
            ],
            investors: [
                {
                    question: "How secure are international property transactions on Estalara?",
                    answer: "Security is our top priority. Estalara verifies all agents and investors, provides secure payment processing, works with trusted notaries and title insurance companies, and ensures legal compliance in all jurisdictions. We use industry-standard encryption and follow GDPR and international data protection regulations. All financial transactions are processed through certified payment providers."
                },
                {
                    question: "Can I watch property tours if I can't attend live?",
                    answer: "Yes! All live property tours are recorded and available for on-demand viewing. You can watch recordings at your convenience, and our AI assistant can answer questions about properties 24/7. You'll also receive notifications when new tours are scheduled for properties matching your preferences."
                },
                {
                    question: "What happens after I express interest in a property?",
                    answer: "When you express interest, you're immediately connected with the listing agent who will provide detailed information, arrange private viewings (virtual or in-person), answer questions, and guide you through the purchase process. Our platform facilitates all communication and documentation in your preferred language."
                },
                {
                    question: "Are there any fees for investors?",
                    answer: "Creating an account and browsing properties on Estalara is completely free for investors. You only pay standard real estate transaction fees when you actually purchase a property. There are no platform fees, subscription costs, or hidden charges for investors."
                },
                {
                    question: "Do you provide financing assistance?",
                    answer: "While Estalara doesn't directly provide financing, we partner with international mortgage providers and financial institutions who specialize in cross-border real estate transactions. We can connect you with trusted partners who can discuss financing options for your specific situation."
                }
            ],
            technical: [
                {
                    question: "Is there a mobile app?",
                    answer: "Yes! Estalara is available on both iOS and Android. Download the app from the App Store or Google Play to access all features including live tours, property search, AI assistant, and real-time notifications. The mobile app offers the full functionality of our web platform."
                },
                {
                    question: "How do I contact support?",
                    answer: "Our support team is available 24/7 via email at support@estalara.com, through the in-app chat feature, or by phone. For agent-specific questions, contact agents@estalara.com. For investor support, reach investors@estalara.com. Average response time is under 2 hours."
                },
                {
                    question: "What are your privacy and data policies?",
                    answer: "We take privacy seriously and comply with GDPR, CCPA, and international data protection laws. Your personal information is encrypted, never sold to third parties, and only used to provide our services. Read our full Privacy Policy for complete details."
                }
            ]
        };

        async function populateFAQ() {
            const btn = document.getElementById('populateBtn');
            
            // Check authentication
            if (!currentUser) {
                setStatus('‚ùå You must be signed in to populate FAQ content', 'error');
                return;
            }
            
            // Verify email domain
            if (!currentUser.email.endsWith('@estalara.com')) {
                setStatus('‚ùå Only @estalara.com accounts can populate FAQ content', 'error');
                log('‚ùå Unauthorized email domain: ' + currentUser.email);
                return;
            }
            
            btn.disabled = true;
            
            try {
                log('Starting FAQ population...');
                log('Authenticated as: ' + currentUser.email);
                setStatus('Connecting to Firebase...', 'info');
                
                // Wait for Firebase to be ready
                await window.firebaseReadyPromise;
                log('‚úÖ Connected to Firebase');
                
                const db = firebase.database();
                
                // Load existing adminData
                setStatus('Loading existing CMS data...', 'info');
                log('Loading existing adminData from Firebase...');
                const snapshot = await db.ref('adminData').once('value');
                let adminData = snapshot.val() || {};
                log('‚úÖ Loaded existing data');
                
                // Add FAQ data
                setStatus('Populating FAQ content...', 'info');
                log('Adding FAQ data to adminData...');
                adminData.faq = faqData;
                
                // Log what we're adding
                log(`üìù General Questions: ${faqData.general.length} items`);
                log(`üìù For Agents: ${faqData.agents.length} items`);
                log(`üìù For Investors: ${faqData.investors.length} items`);
                log(`üìù Technical & Support: ${faqData.technical.length} items`);
                
                // Save to Firebase
                setStatus('Saving to Firebase...', 'info');
                log('Saving to Firebase...');
                await db.ref('adminData').update({
                    faq: adminData.faq,
                    lastUpdated: firebase.database.ServerValue.TIMESTAMP
                });
                log('‚úÖ Saved to Firebase');
                
                // Save to localStorage as backup
                setStatus('Saving to localStorage...', 'info');
                log('Saving to localStorage...');
                try {
                    localStorage.setItem('estalaraAdminData', JSON.stringify(adminData));
                    log('‚úÖ Saved to localStorage');
                } catch (e) {
                    log('‚ö†Ô∏è Could not save to localStorage: ' + e.message);
                }
                
                setStatus('‚úÖ Success! FAQ content has been populated to CMS', 'success');
                log('üéâ FAQ population complete!');
                log('Total: ' + (faqData.general.length + faqData.agents.length + faqData.investors.length + faqData.technical.length) + ' questions added');
                
            } catch (error) {
                console.error('Error:', error);
                const errorMsg = error.code === 'PERMISSION_DENIED' 
                    ? 'Permission denied. Make sure you are signed in with an @estalara.com account.' 
                    : error.message;
                setStatus('‚ùå Error: ' + errorMsg, 'error');
                log('‚ùå Error: ' + errorMsg);
                
                // Re-enable button only if still authenticated
                if (currentUser) {
                    btn.disabled = false;
                }
            }
        }
    </script>
</body>
</html>
