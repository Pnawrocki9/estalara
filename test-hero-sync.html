<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Hero Synchronizacji</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">üîß Test Synchronizacji Hero Section</h1>
        
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">üìã Instrukcja testu:</h2>
            <ol class="list-decimal list-inside space-y-2 text-gray-700">
                <li>Otw√≥rz <strong>cms.html</strong> w osobnej karcie</li>
                <li>Przejd≈∫ do zak≈Çadki <strong>"üé® Hero"</strong></li>
                <li>Wybierz stronƒô <strong>"Home"</strong></li>
                <li>Wprowad≈∫ dane testowe:
                    <ul class="ml-8 mt-2 list-disc list-inside">
                        <li>Hero Title: <code class="bg-gray-100 px-2 py-1 rounded">NOWY TYTU≈Å TESTOWY</code></li>
                        <li>Hero Subtitle: <code class="bg-gray-100 px-2 py-1 rounded">To jest nowy podtytu≈Ç z panelu CMS!</code></li>
                    </ul>
                </li>
                <li>Kliknij <strong>"üíæ Save Hero Section"</strong></li>
                <li>Wr√≥ƒá tutaj i kliknij <strong>"üîÑ Sprawd≈∫ Synchronizacjƒô"</strong></li>
            </ol>
        </div>

        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">üìä Status Danych:</h2>
            <button onclick="checkSync()" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 mb-4">
                üîÑ Sprawd≈∫ Synchronizacjƒô
            </button>
            <div id="results" class="mt-4"></div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">üîç Szczeg√≥≈Çy Techniczne:</h2>
            <pre id="technical-details" class="bg-gray-100 p-4 rounded overflow-x-auto text-sm"></pre>
        </div>
    </div>

    <script src="content-store.js"></script>
    <script>
        async function checkSync() {
            const resultsDiv = document.getElementById('results');
            const detailsDiv = document.getElementById('technical-details');
            
            resultsDiv.innerHTML = '<p class="text-gray-600">≈Åadowanie danych...</p>';
            
            // Load data from localStorage
            const stored = localStorage.getItem('estalaraAdminData');
            
            if (!stored) {
                resultsDiv.innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded p-4">
                        <p class="text-red-800">‚ùå Brak danych w localStorage!</p>
                        <p class="text-sm text-red-600 mt-2">Sprawd≈∫ czy zapisa≈Çe≈õ dane w CMS.</p>
                    </div>
                `;
                return;
            }
            
            const data = JSON.parse(stored);
            
            // Check for home page hero data
            const homePage = data.pages?.home || {};
            
            // Check both old and new formats
            const oldFormat = {
                title: homePage.heroTitle,
                subtitle: homePage.heroSubtitle
            };
            
            const newFormat = {
                title: homePage.hero?.title,
                subtitle: homePage.hero?.subtitle
            };
            
            // Determine which format is being used
            const hasOldFormat = !!(oldFormat.title || oldFormat.subtitle);
            const hasNewFormat = !!(newFormat.title || newFormat.subtitle);
            
            let statusHTML = '';
            
            if (hasNewFormat) {
                statusHTML = `
                    <div class="bg-green-50 border border-green-200 rounded p-4">
                        <h3 class="font-semibold text-green-900 mb-2">‚úÖ Nowy Format (Poprawny)</h3>
                        <p class="text-green-800"><strong>Title:</strong> ${newFormat.title || '(puste)'}</p>
                        <p class="text-green-800"><strong>Subtitle:</strong> ${newFormat.subtitle || '(puste)'}</p>
                    </div>
                `;
            } else if (hasOldFormat) {
                statusHTML = `
                    <div class="bg-yellow-50 border border-yellow-200 rounded p-4">
                        <h3 class="font-semibold text-yellow-900 mb-2">‚ö†Ô∏è Stary Format (Zostanie zmigrowany)</h3>
                        <p class="text-yellow-800"><strong>Title:</strong> ${oldFormat.title || '(puste)'}</p>
                        <p class="text-yellow-800"><strong>Subtitle:</strong> ${oldFormat.subtitle || '(puste)'}</p>
                        <p class="text-sm text-yellow-700 mt-2">System automatycznie zmigrowuje to do nowego formatu przy nastƒôpnym za≈Çadowaniu strony.</p>
                    </div>
                `;
            } else {
                statusHTML = `
                    <div class="bg-red-50 border border-red-200 rounded p-4">
                        <h3 class="font-semibold text-red-900 mb-2">‚ùå Brak Danych Hero</h3>
                        <p class="text-red-800">Nie znaleziono danych hero dla strony Home.</p>
                    </div>
                `;
            }
            
            resultsDiv.innerHTML = statusHTML;
            
            // Show technical details
            const technicalInfo = {
                'Struktura danych': {
                    'Nowy format (pages.home.hero)': hasNewFormat ? '‚úÖ' : '‚ùå',
                    'Stary format (pages.home.heroTitle)': hasOldFormat ? '‚úÖ' : '‚ùå'
                },
                'Warto≈õci': {
                    'NEW - hero.title': newFormat.title || '(brak)',
                    'NEW - hero.subtitle': newFormat.subtitle || '(brak)',
                    'OLD - heroTitle': oldFormat.title || '(brak)',
                    'OLD - heroSubtitle': oldFormat.subtitle || '(brak)'
                },
                'Status migracji': {
                    'Wymaga migracji': hasOldFormat && !hasNewFormat ? 'TAK' : 'NIE',
                    'Gotowy do u≈ºycia': hasNewFormat ? 'TAK' : 'NIE'
                }
            };
            
            detailsDiv.textContent = JSON.stringify(technicalInfo, null, 2);
            
            // Test ContentStore migration
            if (window.contentStore) {
                console.log('üß™ Testing ContentStore migration...');
                const migratedData = window.contentStore.normalizeData(data);
                console.log('Migrated data:', migratedData.pages?.home?.hero);
            }
        }
        
        // Auto-run on load
        window.addEventListener('load', () => {
            setTimeout(checkSync, 500);
        });
    </script>
</body>
</html>
