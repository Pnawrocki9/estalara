<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Initialize Success Journey Data</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="firebase-db.js"></script>
    <script src="cms-firebase-adapter.js"></script>
    
    <script>
        // Initialize Success Journey data in localStorage and Firebase
        async function initializeSuccessJourney() {
            console.log('üöÄ Initializing Success Journey data...');
            
            // Load existing admin data or create new
            let admin = {};
            try {
                const stored = localStorage.getItem('estalaraAdminData');
                if (stored) {
                    admin = JSON.parse(stored);
                }
            } catch (e) {
                console.error('Error loading existing data:', e);
            }
            
            // Ensure structure exists
            if (!admin.pages) admin.pages = {};
            if (!admin.pages.agents) admin.pages.agents = {};
            
            // Add Success Journey with all 4 steps
            admin.pages.agents.successJourney = {
                heading: 'Your Success Journey',
                subtitle: 'From signup to closing deals - your path to global real estate success',
                steps: [
                    {
                        number: '1',
                        title: 'Sign Up',
                        description: 'Create your agent profile and verify your credentials'
                    },
                    {
                        number: '2',
                        title: 'List Properties',
                        description: 'Upload your listings with photos and detailed information'
                    },
                    {
                        number: '3',
                        title: 'Go Live',
                        description: 'Start streaming to global investors and engage in real-time'
                    },
                    {
                        number: '4',
                        title: 'Close Deals',
                        description: 'Convert leads into sales with our streamlined process'
                    }
                ]
            };
            
            // Save to localStorage
            localStorage.setItem('estalaraAdminData', JSON.stringify(admin));
            
            console.log('‚úÖ Success Journey initialized in localStorage!');
            console.log('Steps:', admin.pages.agents.successJourney.steps.map(s => `${s.number}. ${s.title}`).join(', '));
            
            // Try to sync to Firebase
            let firebaseStatus = 'Not attempted';
            try {
                if (window.cmsFirebaseAdapter) {
                    await window.cmsFirebaseAdapter.init();
                    const result = await window.cmsFirebaseAdapter.saveAdminData(admin);
                    if (result.success) {
                        firebaseStatus = '‚úÖ Synced to Firebase';
                        console.log('‚úÖ Success Journey synced to Firebase!');
                    } else {
                        firebaseStatus = '‚ö†Ô∏è Firebase sync failed (data saved locally)';
                        console.warn('‚ö†Ô∏è Firebase sync failed:', result.error);
                    }
                } else {
                    firebaseStatus = '‚ö†Ô∏è Firebase adapter not available (data saved locally)';
                }
            } catch (error) {
                firebaseStatus = '‚ö†Ô∏è Firebase error: ' + error.message;
                console.error('‚ùå Firebase sync error:', error);
            }
            
            // Display success message
            document.getElementById('status').innerHTML = `
                <div style="padding: 20px; background: #d4edda; color: #155724; border: 1px solid #c3e6cb; border-radius: 5px;">
                    <h2>‚úÖ Success Journey Initialized!</h2>
                    <p>The following steps have been added to the CMS:</p>
                    <ol style="margin: 10px 0; padding-left: 20px;">
                        ${admin.pages.agents.successJourney.steps.map(s => `<li><strong>${s.title}</strong>: ${s.description}</li>`).join('')}
                    </ol>
                    <p style="margin-top: 10px;"><strong>Firebase Status:</strong> ${firebaseStatus}</p>
                    <p style="margin-top: 15px;">
                        <a href="cms.html" style="color: #155724; text-decoration: underline;">Open CMS</a> to view and edit, or 
                        <a href="agents.html" style="color: #155724; text-decoration: underline;">view Agents page</a> to see the result.
                    </p>
                </div>
            `;
        }
        
        // Run on page load
        window.addEventListener('DOMContentLoaded', initializeSuccessJourney);
    </script>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        #status {
            margin-top: 30px;
        }
        a {
            color: #007bff;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1>üöÄ Initialize Success Journey Data</h1>
    <p>This page will initialize the Success Journey section with content from the frontend.</p>
    <div id="status">
        <p>Initializing...</p>
    </div>
</body>
</html>
